# ガイドライン

## AGENTS.mdの役割

<https://www.humanlayer.dev/blog/writing-a-good-claude-md>

- エージェントをオンボードするための最も重要なファイル
- プロジェクトの目的・構成・実行方法を定義する
- 指示は必要最小限にし、普遍的に適用できる内容に集中させ、ファイルの長さを抑える
- 段階的開示を使ってタスク固有の情報を別ファイルに分け、無関係な情報でコンテキストウィンドウを圧迫しない
- Linterや自動生成機能に頼らず、`AGENTS.md`は人間が慎重に作成することを推奨する

### ファイルの長さを抑える

- 多くても100命令以下に抑える
- 多くても300行以下に抑える
- `AGENTS.md`が増えるほど、コンテキストウィンドウを圧迫し、精度が下がる

### 段階的開示（agent-docs）

- `./agent-docs`にナレッジを格納する
- `./agent-docs`のパスだけを`AGENTS.md`に記載する

#### skillsとの違い

- SKILL.md：目的に対する手段の提示 ... なんのスキルか？の説明から段階的に開示（ツールに似た使い方）
- AGENTS.md + docs：目的に対する解決のヒントを提示 ... なんのコンテキストか？の説明から段階的開示（ここにナレッジが転がってるよ）

### Linterを使う

- コードガイドラインは`AGENTS.md`に入れない
- 従来のLinterで解決する問題なので、LLMにやらせる仕事ではない
- `HOOKS`でLinterを使ってSTOPしよう

## ハーネス

<https://www.anthropic.com/engineering/effective-harnesses-for-long-running-agents>

- 役割の分離: 最初の「環境構築（初期化）」と、それ以降の「継続実装」でプロンプトを分ける
  - 初期化エージェント: 最初のセッションでは、専用のプロンプトを使用してモデルに初期環境のセットアップを依頼する
    - init.shスクリプト、エージェントの作業ログを記録するclaude-progress.txtファイル、追加されたファイルを示す初期gitコミットなど
  - コーディングエージェント: それ以降のすべてのセッションでは、モデルに段階的な進捗を作り、構造化された更新内容を残すよう依頼する
コーディングエージェント: それ以降のすべてのセッションでは、モデルに段階的な進捗を作り、構造化された更新内容を残すよう依頼します。
- 記憶の外部化: claude-progress.txt等の進捗ログを作り、セッション間の記憶の欠落を防ぐ
- Gitによる状態管理: エージェントにコミット・履歴確認・ロールバック（復旧）を自律的に行わせる
- 詳細な機能リスト(JSON): 最初に全要件をJSON化し、未完了を可視化して「早すぎる完了宣言」を防ぐ
- スモールステップの徹底: 一度に多くを詰め込まず、1セッション1機能に絞って段階的に進める
- 構造化データの活用: MarkdownよりAIが壊しにくいJSON形式で要件や進捗を管理する
- 環境起動の自動化: init.sh等を用意し、エージェントが自力で即座に開発環境を再開できるようにする
- 開始時のルーチン化: セッション冒頭で必ずディレクトリ・ログ・機能リストを確認する手順を組む
- E2Eテストの実行: コード推論だけでなく、ブラウザ自動操作等で「実際に動くか」を検証させる
- クリーンな終了: 次のセッションが迷わないよう、バグを残さず整理整頓してから終了させる

## ClaudeCodeハーネスを別のLLMで利用する

<https://www.youtube.com/watch?v=4bN5T2pGcEc>
<https://openrouter.ai/docs/guides/guides/claude-code-integration>
<https://docs.z.ai/devpack/tool/claude>
